<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Rating System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
    <style>
        body { background-color: #f0f2f5; padding-top: 40px; }
        .card { border: none; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .star-rating { color: #ffc107; font-size: 1.2rem; }
        .rating-summary-box { 
            text-align: center; 
            padding: 10px; 
            border-radius: 8px; 
            background: #fff; 
            border: 1px solid #dee2e6;
            margin-bottom: 10px;
        }
        .rating-count { font-weight: bold; font-size: 1.5rem; display: block; }
        .rating-label { font-size: 0.8rem; color: #6c757d; }
    </style>
</head>
<body>

<div class="container" style="max-width: 800px;">
    
    <h3 class="text-center mb-4">Feedback Dashboard</h3>
    
    <div class="row mb-4" id="ratingSummary">
        <div class="col"><div class="rating-summary-box"><span class="rating-count" id="count-1">0</span><span class="rating-label">1 Star ★</span></div></div>
        <div class="col"><div class="rating-summary-box"><span class="rating-count" id="count-2">0</span><span class="rating-label">2 Stars ★★</span></div></div>
        <div class="col"><div class="rating-summary-box"><span class="rating-count" id="count-3">0</span><span class="rating-label">3 Stars ★★★</span></div></div>
        <div class="col"><div class="rating-summary-box"><span class="rating-count" id="count-4">0</span><span class="rating-label">4 Stars ★★★★</span></div></div>
        <div class="col"><div class="rating-summary-box"><span class="rating-count" id="count-5">0</span><span class="rating-label">5 Stars ★★★★★</span></div></div>
    </div>

    <div class="card mb-4">
        <div class="card-header bg-primary text-white">Leave a Review</div>
        <div class="card-body">
            <form id="ratingForm">
                <div class="row g-3 align-items-center">
                    <div class="col-md-7">
                        <label class="form-label">Your Name</label>
                        <input type="text" class="form-control" id="name" required placeholder="Enter your name">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Rating</label>
                        <select class="form-select" id="rating" required>
                            <option value="1">1 ★</option>
                            <option value="2">2 ★★</option>
                            <option value="3">3 ★★★</option>
                            <option value="4">4 ★★★★</option>
                            <option value="5">5 ★★★★★</option>
                        </select>
                    </div>
                    <div class="col-md-2" style="margin-top: 2.4rem;">
                        <button type="submit" class="btn btn-dark w-100">Submit</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <h5 class="mb-3">Recent Reviews</h5>
    <div class="list-group" id="reviewsList">
        </div>

</div>

<script>
    const API_URL = "https://crudcrud.com/api/abf64227228c404d99835101ffd78db0/ratings";
    
   
    let ratingCounts = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };

   
    window.addEventListener("DOMContentLoaded", async () => {
        try {
            const response = await axios.get(API_URL);
            const reviews = response.data;
            
           
            reviews.forEach(review => {
                displayReview(review);
                updateCounter(review.rating, 1);
            });
        } catch (error) {
            console.error("Error loading data:", error);
            alert("Failed to load reviews. Check API Endpoint.");
        }
    });

   
    document.getElementById("ratingForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const nameInput = document.getElementById("name");
        const ratingInput = document.getElementById("rating");

        const newReview = {
            name: nameInput.value,
            rating: parseInt(ratingInput.value)
        };

        try {
            const response = await axios.post(API_URL, newReview);
            displayReview(response.data);
            updateCounter(newReview.rating, 1);
            nameInput.value = "";
            ratingInput.value = "1";
        } catch (error) {
            console.error("Error posting data:", error);
        }
    });

   
    document.getElementById("reviewsList").addEventListener("click", async (e) => {
        
       
        if (e.target.classList.contains("delete-btn")) {
            const item = e.target.closest(".list-group-item");
            const id = item.dataset.id;
            const rating = parseInt(item.dataset.rating);

            try {
                await axios.delete(`${API_URL}/${id}`);
                item.remove();
                updateCounter(rating, -1);
            } catch (error) {
                console.error("Error deleting:", error);
            }
        }

       
        if (e.target.classList.contains("edit-btn")) {
            const item = e.target.closest(".list-group-item");
            const id = item.dataset.id;
            const oldName = item.querySelector(".review-name").innerText;
            const oldRating = parseInt(item.dataset.rating);

           
            document.getElementById("name").value = oldName;
            document.getElementById("rating").value = oldRating;

           
            try {
                await axios.delete(`${API_URL}/${id}`);
                item.remove();
                updateCounter(oldRating, -1);
            } catch (error) {
                console.error("Error preparing edit:", error);
            }
        }
    });

   
    function displayReview(review) {
        const list = document.getElementById("reviewsList");
        
       
        const stars = "★".repeat(review.rating) + "☆".repeat(5 - review.rating);
        
        const html = `
            <div class="list-group-item d-flex justify-content-between align-items-center" data-id="${review._id}" data-rating="${review.rating}">
                <div>
                    <h6 class="mb-0 fw-bold review-name">${review.name}</h6>
                    <span class="star-rating text-warning">${stars}</span>
                </div>
                <div>
                    <button class="btn btn-sm btn-outline-primary edit-btn me-2">Edit</button>
                    <button class="btn btn-sm btn-outline-danger delete-btn">Delete</button>
                </div>
            </div>
        `;
        
        list.insertAdjacentHTML("beforeend", html);
    }

   
    function updateCounter(rating, change) {
       
        ratingCounts[rating] += change;
        
       
        const counterElement = document.getElementById(`count-${rating}`);
        if(counterElement) {
            counterElement.innerText = ratingCounts[rating];
        }
    }
</script>

</body>
</html>